user  nginx;
worker_processes  auto;

events {
    worker_connections  1024;
}

http {
	include         mime.types;
    default_type    application/octet-stream;
	server_tokens	off;

	client_max_body_size	1m;
    log_format main	'$remote_addr - $remote_user [$time_local] "$request" '
					'$status $body_bytes_sent "$http_referer" '
					'"$http_user_agent" "$http_x_forwarded_for"';

	upstream web {
		server	unix:/opt/nginx/web.sock;
	}

	server {
		listen			80;
		server_name		benlittledev.com;
		location /.well-known {
			root		/var/www;
			try_files	$uri =404;
		}    
		location / {
			return	302 https://$host$request_uri;
		}    
	}

	#server {
	#	listen			80;
	#	server_name		${tor_addr_benlittledev};
	#	location / {
	#		proxy_pass	http://web;
	#	}
	#}

	server {
		listen       443 ssl;
		server_name  benlittledev.com;
		proxy_ssl_server_name		on;
		ssl_prefer_server_ciphers	on;
		ssl_ciphers	"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384";
		ssl_session_cache	shared:SSL:10m;
		ssl_session_timeout	10m;
		ssl_protocols		tlsv1 tlsv1.1 tlsv1.2 tlsv1.3;
		ssl_certificate		/etc/letsencrypt/live/$host/fullchain.pem;
		ssl_certificate_key	/etc/letsencrypt/live/$host/privkey.pem;

		location / {
			proxy_pass  http://web;
		}
	}

}
